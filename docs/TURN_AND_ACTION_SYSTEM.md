# Turn and Action System - Fate-Inspired Design

## Overview

This document replaces the "frame" terminology with a proper **Turn/Event** system inspired by the **Fate Core** RPG system (Creative Commons Attribution 3.0 license). This gives us a solid foundation for actions, time, and game mechanics.

---

## Why Fate Core?

### License
- **Creative Commons Attribution 3.0** - Fully open, can be used commercially
- Well-documented SRD at https://fate-srd.com
- No royalties, no restrictions beyond attribution

### Fit for AI-Driven RPG
- **Narrative-focused** - Perfect for LLM storytelling
- **Four Actions** - Simple action framework (Overcome, Create Advantage, Attack, Defend)
- **Aspects** - Narrative tags that work well with LLM context
- **Stress/Consequences** - Elegant damage system that creates story
- **Flexible time** - Actions can represent seconds or hours based on context
- **Conflicts vs Challenges vs Contests** - Different zoom levels for drama

---

## Core Terminology Changes

| Old Term | New Term | Description |
|----------|----------|-------------|
| Frame | **Event** | A single thing that happened |
| Frame Number | **Event ID** | Unique identifier for an event |
| - | **Turn** | A player's opportunity to act (contains events) |
| - | **Round** | A complete cycle where all participants act (combat) |
| - | **Scene** | A logical grouping of turns in one location/situation |
| Session | **Session** | A complete play session (still valid) |
| Checkpoint | **Snapshot** | Full game state capture |

---

## Time Model

### Abstract Time (Exploration/Roleplay)

When not in structured conflict, time is **narrative**:

```
┌─────────────────────────────────────────────────────────┐
│                    SCENE: Market District                │
├─────────────────────────────────────────────────────────┤
│  Turn 1: Player browses market stalls                   │
│    └─ Events: [move, observe, chat_vendor]              │
│                                                          │
│  Turn 2: Player talks to information broker             │
│    └─ Events: [interact_npc, knowledge_gained]          │
│                                                          │
│  Turn 3: Player decides to travel                       │
│    └─ Events: [travel_start, encounter_check, arrive]   │
│                                                          │
│  [Scene ends - new scene at destination]                │
└─────────────────────────────────────────────────────────┘

Time passed: ~2 hours (narrative, not tracked precisely)
```

### Structured Time (Combat/Conflicts)

When drama requires precision, time becomes **structured**:

```
┌─────────────────────────────────────────────────────────┐
│                 CONFLICT: Alley Ambush                  │
├─────────────────────────────────────────────────────────┤
│  Round 1:                                               │
│  ├─ Turn 1 (Player): Attack thug                       │
│  │   └─ Events: [attack_roll, damage_dealt]            │
│  ├─ Turn 2 (Thug A): Defend, counter-attack            │
│  │   └─ Events: [defend_roll, attack_roll, miss]       │
│  └─ Turn 3 (Thug B): Flee                              │
│      └─ Events: [movement, exit_scene]                 │
│                                                          │
│  Round 2:                                               │
│  ├─ Turn 4 (Player): Chase thug B                      │
│  │   └─ Events: [athletics_roll, catch_up]             │
│  └─ Turn 5 (Thug A): Surrender                         │
│      └─ Events: [concession, conflict_end]             │
│                                                          │
│  [Conflict ends - return to narrative time]             │
└─────────────────────────────────────────────────────────┘

Time passed: ~30 seconds (precise, tracked per round)
```

---

## Turn Structure

### What Is a Turn?

A **Turn** is a player's (or NPC's) opportunity to act. Each turn can contain multiple **Events**.

```javascript
Turn = {
  turnId: number,           // Sequential within session
  turnNumber: number,       // Sequential within scene
  actor: string,            // Who is acting ("player", "npc-123", "gm")
  sceneId: string,          // Which scene this turn belongs to
  timestamp: number,        // Real-world timestamp
  gameTime: GameTime,       // In-game time reference
  
  // Actions taken this turn
  actions: Action[],        // 1-3 actions depending on context
  
  // Events generated by this turn
  events: Event[],          // All events that occurred
  
  // State changes
  stateChanges: StateChange[],
  
  // LLM context
  llmContext: {
    prompt: string,
    response: string,
    seed: number,
    model: string
  }
}
```

### What Is an Event?

An **Event** is a single atomic thing that happened. Events are the smallest unit of game history.

```javascript
Event = {
  eventId: string,          // Unique: "session-turn-seq" e.g., "abc123-42-3"
  turnId: number,           // Which turn generated this event
  sequence: number,         // Order within the turn (1, 2, 3...)
  
  type: EventType,          // See Event Types below
  
  // What happened
  actor: string,            // Who did it
  target: string | null,    // Who/what was affected
  action: string,           // What action was taken
  
  // Mechanical details
  skill: string | null,     // Skill used (if any)
  difficulty: number | null,// Target number (if any)
  roll: DiceRoll | null,    // Dice result (if any)
  shifts: number | null,    // Success margin (Fate term)
  
  // Narrative
  description: string,      // What happened in story terms
  
  // Consequences
  outcome: "success" | "tie" | "failure" | "success_with_cost",
  effects: Effect[]         // State changes caused
}
```

---

## Event Types

### Core Event Types (Fate-Inspired)

```typescript
type EventType = 
  // Four Actions (Fate Core)
  | "overcome"           // Overcome an obstacle
  | "create_advantage"   // Create/discover an aspect
  | "attack"             // Harm someone in conflict
  | "defend"             // Prevent harm to yourself
  
  // Scene Management
  | "scene_start"        // Begin a new scene
  | "scene_end"          // End current scene
  | "conflict_start"     // Begin structured conflict
  | "conflict_end"       // End conflict (resolution)
  
  // Movement & Travel
  | "move"               // Move within scene/zone
  | "travel"             // Travel between locations
  | "arrive"             // Arrive at destination
  | "encounter"          // Random/scripted encounter
  
  // Social & Knowledge
  | "interact"           // Talk to NPC
  | "knowledge_gain"     // Learn something new
  | "knowledge_share"    // Tell someone something
  | "relationship_change"// Relationship modifier
  
  // Quests
  | "quest_update"       // Quest started, updated, or completed

  // Inventory & Resources
  | "item_gain"          // Acquire item
  | "item_lose"          // Lose/use item
  | "item_use"           // Use item for effect
  | "resource_change"    // Currency, stress, etc.
  
  // State & Consequences
  | "stress_taken"       // Take stress (Fate damage)
  | "consequence_taken"  // Take consequence (lasting harm)
  | "consequence_clear"  // Recover from consequence
  | "aspect_created"     // New aspect on scene/character
  | "aspect_removed"     // Aspect goes away
  | "compel"             // Aspect compelled for drama
  
  // Meta/System
  | "turn_start"         // Turn begins
  | "turn_end"           // Turn ends  
  | "round_start"        // Combat round begins
  | "round_end"          // Combat round ends
  | "snapshot"           // Full state captured
  | "session_start"      // Session begins
  | "session_end"        // Session ends
  | "gm_narration"       // Pure narrative, no action
```

---

## Actions Per Turn

### Narrative Time (Exploration)

In narrative time, a turn can include **multiple actions** as makes sense:

```javascript
// Player's turn exploring the market
{
  turnId: 42,
  actor: "player",
  actions: [
    { type: "move", target: "vendor_stall" },
    { type: "interact", target: "npc-vendor-01", subtype: "browse" },
    { type: "overcome", skill: "Notice", target: "hidden_item" }
  ],
  events: [
    { type: "move", description: "You walk to the vendor stall" },
    { type: "interact", description: "The vendor shows you their wares" },
    { type: "overcome", roll: { result: 3 }, outcome: "success",
      description: "You notice a rare component hidden under the counter" }
  ]
}
```

### Structured Time (Conflict)

In conflict, actions are **limited per turn** (typically 1 main action + 1 movement):

```javascript
// Player's turn in combat
{
  turnId: 58,
  actor: "player",
  context: "conflict",
  actions: [
    { type: "move", zones: 1 },           // Free movement
    { type: "attack", target: "thug-01" } // Main action
  ],
  events: [
    { type: "move", description: "You close the distance" },
    { type: "attack", skill: "Fight", roll: { result: 4 }, 
      shifts: 2, outcome: "success",
      description: "Your blade finds its mark" },
    { type: "stress_taken", target: "thug-01", amount: 4 }
  ]
}
```

---

## Game Time Model

### GameTime Object

```javascript
GameTime = {
  // Absolute time
  day: number,              // Day in game world (1, 2, 3...)
  timeOfDay: TimeOfDay,     // "dawn" | "morning" | "noon" | "afternoon" | "evening" | "night" | "midnight"
  hour: number,             // 0-23 (optional precision)
  
  // Relative tracking
  turnsSinceSceneStart: number,
  turnsSinceConflictStart: number | null,
  roundNumber: number | null,  // Only during conflict
  
  // Narrative time passage
  lastAdvance: {
    amount: number,
    unit: "minutes" | "hours" | "days",
    reason: string
  }
}
```

### Time Advancement Rules

```javascript
// Different actions advance time differently
const TIME_COSTS = {
  // Narrative actions (flexible)
  "move": { min: 1, max: 5, unit: "minutes" },
  "interact": { min: 5, max: 30, unit: "minutes" },
  "travel": { perZone: 15, unit: "minutes" },  // Or more for long distances
  "rest": { amount: 8, unit: "hours" },
  "search": { min: 10, max: 60, unit: "minutes" },
  
  // Conflict actions (precise)
  "conflict_round": { amount: 6, unit: "seconds" },
  "attack": { amount: 0, unit: "seconds" },  // Part of round
  "defend": { amount: 0, unit: "seconds" },  // Part of round
  
  // Special
  "snapshot": { amount: 0, unit: "seconds" },  // Meta, no time
  "gm_narration": { variable: true }  // GM decides
}
```

### Time of Day Effects

```javascript
// NPCs have schedules tied to time of day
const TIME_PERIODS = {
  dawn:      { hours: [5, 6],     npcActivity: "waking" },
  morning:   { hours: [7, 8, 9, 10, 11], npcActivity: "work_early" },
  noon:      { hours: [12, 13],   npcActivity: "lunch" },
  afternoon: { hours: [14, 15, 16, 17], npcActivity: "work_late" },
  evening:   { hours: [18, 19, 20, 21], npcActivity: "social" },
  night:     { hours: [22, 23, 0, 1], npcActivity: "leisure" },
  midnight:  { hours: [2, 3, 4],  npcActivity: "sleep" }
}
```

---

## Scene Structure

### What Is a Scene?

A **Scene** is a logical grouping of turns that happen in one place/situation.

```javascript
Scene = {
  sceneId: string,
  sessionId: string,
  
  // Location
  locationId: string,
  locationName: string,
  
  // Time span
  startTime: GameTime,
  endTime: GameTime | null,
  
  // Scene aspects (Fate concept)
  aspects: Aspect[],        // "Crowded Market", "Suspicious Guards"
  
  // Participants
  npcsPresent: string[],    // NPC IDs in scene
  
  // Turns in this scene
  turns: number[],          // Turn IDs belonging to this scene
  
  // Scene type
  type: "exploration" | "social" | "conflict" | "travel" | "downtime",
  
  // If conflict
  conflict: ConflictData | null
}
```

### Scene Flow

```
SESSION START
    │
    ▼
┌─────────────────┐
│  Scene 1        │ ◄── Player starts in location
│  (exploration)  │
│  Turns: 1-5     │
└────────┬────────┘
         │
         ▼ [Player travels]
┌─────────────────┐
│  Scene 2        │ ◄── Travel scene (may have encounter)
│  (travel)       │
│  Turns: 6-8     │
└────────┬────────┘
         │
         ▼ [Encounter triggered]
┌─────────────────┐
│  Scene 3        │ ◄── Combat scene
│  (conflict)     │
│  Turns: 9-15    │
│  Rounds: 1-3    │
└────────┬────────┘
         │
         ▼ [Conflict resolved]
┌─────────────────┐
│  Scene 4        │ ◄── Arrive at destination
│  (exploration)  │
│  Turns: 16-20   │
└────────┬────────┘
         │
         ▼
    SESSION END
```

---

## Fate Core Mechanics to Adopt

### The Four Actions

Every meaningful action falls into one of four categories:

| Action | Use When | Outcome |
|--------|----------|---------|
| **Overcome** | Getting past an obstacle | Success/Failure/Cost |
| **Create Advantage** | Setting up future success | Aspect created/discovered |
| **Attack** | Harming someone in conflict | Stress dealt |
| **Defend** | Preventing harm/advantage | Block/reduce effect |

### Aspects

**Aspects** are narrative tags that can be invoked for bonuses or compelled for drama:

```javascript
Aspect = {
  id: string,
  name: string,              // "On Fire", "Ancient Grudge", "Hidden Passage"
  type: "character" | "situation" | "consequence" | "boost",
  attachedTo: string,        // Character ID, scene ID, etc.
  freeInvokes: number,       // Uses before requiring Fate Point
  source: string,            // How it was created
  persistent: boolean        // Lasts beyond scene?
}
```

### Stress and Consequences (Damage System)

Instead of HP, Fate uses **Stress** (temporary) and **Consequences** (lasting):

```javascript
// Stress boxes - checked off, clear after scene
stress: {
  physical: [false, false, false],  // 3 boxes
  mental: [false, false, false]
}

// Consequences - aspects that represent harm
consequences: {
  mild: null,      // -2 shift, clears next scene
  moderate: null,  // -4 shift, clears next session  
  severe: null     // -6 shift, clears after major milestone
}

// When stress overflows into consequences, create aspect
// "Broken Arm" (moderate consequence) = an aspect enemies can invoke
```

### The Ladder (Difficulty Scale)

```
+8  Legendary
+7  Epic
+6  Fantastic
+5  Superb      ◄── Expert human peak
+4  Great       ◄── Professional level
+3  Good        ◄── Trained/skilled
+2  Fair        ◄── Competent
+1  Average     ◄── Basic training
+0  Mediocre    ◄── No skill
-1  Poor
-2  Terrible
```

### Dice Rolls (Fudge Dice)

Fate uses 4dF (four Fudge dice), each showing +1, 0, or -1:
- Result range: -4 to +4
- Bell curve centered on 0
- Most common results: -1, 0, +1

```javascript
// For digital implementation
function rollFudgeDice() {
  let total = 0;
  const dice = [];
  for (let i = 0; i < 4; i++) {
    const die = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
    dice.push(die);
    total += die;
  }
  return { dice, total };
}

// Final result = roll + skill
// Compare to difficulty or opposed roll
// Shifts = result - opposition (positive = success degree)
```

---

## Integration with Existing Systems

### How Turns/Events Map to Session Logging

```javascript
// Session file references turns
// Turns are stored separately for efficiency
// Events are the atomic log entries

SessionFile → references → TurnFiles → contain → Events
```

### Turn File Structure

Each turn gets logged with all its events:

```javascript
// turns/session-abc123/turn-0042.json
{
  "turn": {
    "turnId": 42,
    "sessionId": "abc123",
    "sceneId": "scene-007",
    "actor": "player",
    "timestamp": 1732557777531,
    "gameTime": {
      "day": 3,
      "timeOfDay": "afternoon",
      "hour": 15
    }
  },
  "actions": [
    {
      "type": "overcome",
      "skill": "Athletics",
      "target": "locked_gate",
      "difficulty": 3
    }
  ],
  "events": [
    {
      "eventId": "abc123-42-1",
      "type": "overcome",
      "actor": "player",
      "skill": "Athletics",
      "difficulty": 3,
      "roll": { "dice": [1, 0, 1, -1], "total": 1 },
      "skillTotal": 3,
      "result": 4,
      "shifts": 1,
      "outcome": "success",
      "description": "You vault over the gate with surprising grace"
    }
  ],
  "stateChanges": [
    { "type": "location", "from": "outside_gate", "to": "inside_compound" }
  ],
  "llmContext": {
    "narrativePrompt": "Describe the player vaulting over a locked gate...",
    "narrativeResponse": "You vault over the gate with surprising grace...",
    "seed": 12345,
    "model": "granite4:latest"
  }
}
```

---

## Benefits of This Model

1. **Clear terminology** - Turns and events are intuitive RPG concepts
2. **Flexible time** - Narrative time for exploration, structured for conflict
3. **Fate compatibility** - Can use vast Fate SRD resources
4. **LLM-friendly** - Aspects and narrative focus work well with AI
5. **Deterministic** - All rolls seeded and logged
6. **Granular history** - Can replay/analyze at event level
7. **Legal clarity** - CC BY 3.0 is permissive and clear

---

## Next Steps

1. Create `SESSION_FILE_ARCHITECTURE.md` - Multi-file session structure
2. Update `GAME_LOOP_FLOWCHART.md` - Replace frames with turns/events
3. Create `FATE_MECHANICS_REFERENCE.md` - Quick reference for Fate rules we use
4. Create `PLAYER_CHARACTER_SYSTEM.md` - Character creation using Fate

---

## Attribution

This system incorporates mechanics from **Fate Core System**, a product of Evil Hat Productions, LLC, licensed under the [Creative Commons Attribution 3.0 Unported license](https://creativecommons.org/licenses/by/3.0/).

Fate™ is a trademark of Evil Hat Productions, LLC.
